{% extends 'base.html' %}
{% block title %}{{user_details.first_name}}{% endblock title %}
{% block css %}
<style>
  .whatsapp_float{
    position:fixed;
    bottom:40px;
    right:20px;
  }

  .post_button {
    text-align: right;
  }
  .textarea{
    background-color: #ffffcc;
    border-left: 6px solid #ffeb3b;
    
  }
</style>
{% endblock css %}
{% block body %}
  <h1>Ticket Details:</h1>
  <p><b>Created at</b><br> {{ ticket.created_at }}</p>
  <p><b>Category</b><br>{{ ticket.category }}</p>
  <p><b>Sub category</b><br>{{ ticket.subcategory }}</p>
  <p><b>Title</b><br>{{ ticket.title }}</p>
  <p><b>Description</b><br>{{ ticket.problem_descp }}</p>
  <p><b>Priority</b><br>{{ ticket.priority }}</p>
  <p><b>Status</b><br>{{ ticket.status }}</p>
  
  
  {% if request.user.role != "Viewer" %}
  <p><b>Created By</b><br>{{ ticket.created_by }}</p>
  {% endif %}
  
  {% if ticket.assigned_to %}
  <p><b>Assigned To</b><br>{{ ticket.assigned_to.first_name }} {{ ticket.assigned_to.last_name }}</p>
  {% endif %}
  
  <p><b>Updated at</b><br>{{ ticket.updated_at }}</p>


  {% comment %} Admin {% endcomment %}
  {% if request.user.role == "Admin" and ticket.status == "Pending" %}
      <a href={% url 'ticket_approve' ticket.id %} class="btn btn-primary">Approve</a>
      <a href={% url 'ticket_reject' ticket.id %} class="btn btn-danger">Reject</a>
  {% endif %}


  {% comment %} Manager {% endcomment %}
  {% if request.user.role == "Manager" and ticket.status == "Assigned" %}
    <a href={% url 'ticket_scoping' ticket.id %} class="btn btn-primary">Scoping</a>
    <a href={% url 'ticket_cancel' ticket.id %} class="btn btn-warning">Cancel</a>
  {% endif %}
  
  {% if request.user.role == "Manager" and ticket.status == "Scoping" %}
    <a href={% url 'ticket_inprogress' ticket.id %} class="btn btn-primary">In Progress</a>
    <a href={% url 'ticket_cancel' ticket.id %} class="btn btn-warning">Cancel</a>
    
  {% endif %}

  {% if request.user.role == "Manager" and ticket.status == "In Progress" %}
    <a href={% url 'ticket_completed' ticket.id %} class="btn btn-primary">Completed</a>
    <a href={% url 'ticket_cancel' ticket.id %} class="btn btn-warning">Cancel</a>
  {% endif %}


  {% comment %} Viewer {% endcomment %}
  {% if request.user.role == "Viewer" and ticket.created_by == request.user and ticket.status != "Completed" and ticket.status != "Cancelled" %}
    <a href={% url 'ticket_cancel' ticket.id %} class="btn btn-warning">Cancel</a>
  {% endif %}
    
  <h3>Comment.. </h3>
  <br>
  <br>
  <form method="POST">
    {% csrf_token %}
    <table>
      <tr valign="top">
        <div>
          <th style="padding-right:25px;">Work notes</th>
          <th><textarea name="work_note" class="textarea form-control" style="width:100%" rows="3" cols="160" placeholder="Work notes"></textarea></th>
        </div>
      </tr>
    </table>
    <div class="form-group" style="margin: 30px 0px 30px 0px;">
      <button type="submit" class="btn btn-outline-dark float-right">Post</button>
    </div>
  </form>
  <br/>
  <br/>
  {% for work_note in ticket.work_note_list %}
  <p>{{work_note.commented_by}}<br/>
  {{work_note.comment}}<br/>
  {{work_note.get_created_at}}</p>
  {% endfor %}
  {% if  request.user.role == "Manager"%}
  <div class="whatsapp_float">
    <a href={{my_string}}>To chat with customer click here</a>
  </div>
  {% endif %}
  
{% endblock body %}
{% block js %}{% endblock js %}

{% comment %} input type = hidden value = comment {% endcomment %}